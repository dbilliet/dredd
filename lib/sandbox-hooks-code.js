// Generated by CoffeeScript 1.9.1
var Hooks, Pitboss, sandboxHooksCode;

Pitboss = require('pitboss').Pitboss;

Hooks = require('./hooks');

sandboxHooksCode = function(hooksCode, callback) {
  var hooks, pitboss, wrappedCode;
  hooks = new Hooks();
  wrappedCode = "var _hooks = new _Hooks();\n\nvar before = _hooks.before;\nvar after = _hooks.after;\nvar beforeAll = _hooks.beforeAll;\nvar afterAll = _hooks.afterAll;\nvar beforeEach = _hooks.beforeEach;\nvar afterEach = _hooks.afterEach;\n\n" + hooksCode + "\ntry {\n  var output = _hooks.dumpHooksFunctionsToStrings()\n} catch(e) {\n  console.log(e.message)\n  console.log(e.stack)\n  throw(e)\n}\n\noutput";
  pitboss = new Pitboss(wrappedCode);
  return pitboss.run({
    libraries: {
      "_Hooks": '../../../lib/hooks',
      "console": "console",
      "console": "console"
    }
  }, function(err, result) {
    var ref, ref1, ref2;
    if ((ref = pitboss.runner) != null) {
      if ((ref1 = ref.proc) != null) {
        ref1.removeAllListeners('exit');
      }
    }
    if ((ref2 = pitboss.runner) != null) {
      if (typeof ref2.kill === "function") {
        ref2.kill();
      }
    }
    if (err) {
      return callback(err);
    }
    return callback(void 0, result);
  });
};

module.exports = sandboxHooksCode;
